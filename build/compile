#!/bin/bash
set -euox pipefail

rm -rf dist
mkdir dist
tsc --target es2015 --module commonjs source/machine.ts
cp source/machine.* dist/
coffee build/esbuild.coffee

# Build types
tsc --project build/tsconfig.json

# build hera esbuild-plugin
civet < source/esbuild-plugin.civet > esbuild-plugin.js

# Build 'hera' cli
BIN="dist/hera"
civet < source/cli.civet > "$BIN"
chmod +x "$BIN"
